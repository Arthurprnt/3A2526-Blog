{% extends "base.twig" %}

{% block content %}
	<article>
        {% if success_message %}
			<div class="alert alert-success" role="alert">
				{{ success_message }}
			</div>
		{% endif %}

		<h1 class="mb-3">{{ post.titre }}</h1>

		<p class="text-muted border-bottom pb-3 mb-3">
			Publié le
			{{ post.date_creation|date("d/m/Y à H:i") }}
		</p>

		<div class="lead">
			{{ post.contenu|raw }}
		</div>
	</article>

	<hr class="my-4">
	<div>
		<h4 class="mb-3">
			Commentaires:
		</h4>
	</div>

	<form x-show="connected" class="mb-3 action=" /3A2526-Blog/post/ {{ post.id }} " method=" POST" novalidate>
		
		        {# Champ commentaire #}
		        <div class=" mb-3">
		<textarea class="form-control {% if errors.commentaire %}is-invalid{% endif %}" id="commentaire" name="commentaire" rows="2" placeholder="Ajoutez un commentaire..." required>{{ old_input.commentaire|default('') }}</textarea>
		{% if errors.commentaire %}
			<div class="invalid-feedback">{{ errors.commentaire }}</div>
		{% endif %}
	</div>

	<button type="submit" class="btn btn-primary">Envoyer</button>
</form>

{% for comment in comments %}
	<div class="lead2 mb-3">
		<div class="h-100">
			<div class="d-flex flex-column">
				<h5 class="card-title">{{ comment.nom_auteur }}</h5>
				<p class="card-text">{{ comment.contenu|slice(0, 120) }}</p>
			</div>
			<div class="card-footer text-muted">
				Publié le
				{{ comment.date_creation|date("d/m/Y") }}
			</div>
		</div>
	</div>
{% else %}
	<div class="col-12">
		<p>Aucun commentaire à afficher pour le moment.</p>
	</div>
{% endfor %}

<form action="/3A2526-Blog/edit" method="POST" novalidate>
	<a href="/3A2526-Blog/" class="btn btn-secondary">&larr; Retour à l'accueil</a>

	<input type="hidden" class="form-control {% if errors.titre %}is-invalid{% endif %}" id="envoie" name="envoie" value="false" required>

	<input type="hidden" class="form-control {% if errors.titre %}is-invalid{% endif %}" id="id" name="id" value="{{ post.id }}" required>

	<input type="hidden" class="form-control {% if errors.titre %}is-invalid{% endif %}" id="titre" name="titre" value="{{ post.titre }}" required>

	<textarea class="form-control {% if errors.contenu %}is-invalid{% endif %} d-none" id="contenu" name="contenu" rows="5" required>{{ post.contenu }}</textarea>

	<select cl class="form-control {% if errors.visibilite %}is-invalid{% endif %} d-none" id="visibilite" name="visibilite" rows="5" required>
		<option value="">--- Visibilité du post ---</option>
		<option selected="" value="Publié">Publique</option>
		<option value="Brouillon">Brouillon</option>
	</select>

	{% if canEdit %}
		<button type="submit" class="btn btn-primary">Editer l'article</button>
	{% endif %}
</form>{% endblock %}
